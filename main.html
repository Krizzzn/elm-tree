
<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>~/main.elm</title>
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis-network.min.css">
        <style type="text/css">@import url(http://fonts.googleapis.com/css?family=Source+Sans+Pro);
            html, head, body {
                margin: 0;
                height: 100%;
            }
        </style>
    </head>
<body>

</body>

<style>
    
    .project-container {
        position: relative;
        height: 500px;
        width: 90%;
        border: 1px solid black;
    }

    .project-container #network {
        height: 100%;
        width: 100%;
    }

    .project-container .background {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
        background-color: rgba(255, 255, 255, 0.5);
    }

    .project-container .content {
        position: absolute;
        top: 40px;
        left: 20%;
        background-color: white;
        padding: 10px;
        width: 60%;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        border-radius: 5px;
    }

    .project-container .content h1{
        font-size: 1.20em;
        margin: 0;
    }

    .project-container .content h2{
        font-size: 1.15em;
        margin: 0;
    }

    .project-container .content h3{
        font-size: 1.10em;
        margin: 0;
    }

    .project-container .content h4{
        font-size: 1.05em;
        margin: 0;
    }

</style>

<script src="/_compile/main.elm" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<script>

var app;
if (Elm)
  app = Elm.Main.fullscreen();
else
  app = runElmProgram();

app.ports.tree.subscribe(function(tree) {

  var colors = {
    blue: '#0083BF',
    purple: '#7F3F98',
    green: '#00A886',
    pink: '#EE2375',
    orange: '#FAA21B',
    coolgray06: '#ABA7A7',
    coolgray09: '#78777A',
    coolgray11: '#55565A',
    white: "#FFFFFF"
  };

  var setNodeStyle = function(node, type) {

    node.font = { "color": colors.white };
    node.margin = 10;
    node.fixed = {y: true};
    node.chosen = {
        label: false,
        node:  function(values, id, selected, hovering) {
            values.shadowSize = 16;
        //    values.borderWidth = 1;
        }
    };

    switch (type){
        case "VISION":
            node.mass = 100;
            node.color = colors.blue;
            break;
        case "SO":
            node.color = colors.coolgray06;
            break;
        case "CSF":
            node.color = colors.coolgray09;
            break;
        case "NC":
        default:
            node.color = colors.coolgray11;
            break;
    }
  }

  var typeEx = /^[A-Z]+/;

  for (var i = tree.nodes.length - 1; i >= 0; i--) {
    var node = tree.nodes[i];
    node.label = "[" + node.id + "] " + node.name;

    var type = (typeEx.exec(node.id) || ["any"])[0];
    setNodeStyle(node, type);
  }

  // create an array with nodes
  var nodes = new vis.DataSet(tree.nodes);

  // create an array with edges
  var edges = new vis.DataSet(tree.edges);

  // create a network
  var container = document.getElementById('network');
  var data = {
    nodes: nodes,
    edges: edges
  };

  var shadow = {
    enabled: true,
    size: 7,
    x: 0,
    y: 3
  };

  var zoomable = true;

  var options = {
    interaction: {
      selectable: zoomable,
      dragNodes: false,
      dragView: zoomable,
      zoomView: zoomable
    },
    edges: {
      font: {
        size: 12
      },
      width: 3
    },
    nodes: {
      shape: 'box',
      margin: 5,
      color: '#7BE141',
      borderWidth: 0,
      shadow: shadow,
      widthConstraint: {
        maximum: 200
      }
    },

    physics: {
      enabled: true, 
        hierarchicalRepulsion: {
        nodeDistance: 220
      }
    },
    layout: {
      hierarchical: {
        enabled: true,
        //nodeSpacing: 600,
        //nodeDistance: 600,
        levelSeparation:150,
        blockShifting: true,
        edgeMinimization: false,
        direction: "DU",
        sortMethod: "directed"
        }
    }
};

var network = new vis.Network(container, data, options);
var timeout = null;

network.on("doubleClick", function(e){
    window.clearTimeout(timeout);
    if (e.nodes.length > 0)
        app.ports.selectNode.send(e.nodes[0]);
    else
        app.ports.selectNode.send("VISION");
});

network.on("click", function(e){
    window.clearTimeout(timeout);

    var nodeId = "---";
    if (e.nodes.length > 0)
        nodeId = e.nodes[0];

    timeout = window.setTimeout(function(){
        app.ports.showNode.send(nodeId);
    }, 400);
});


});
</script>
</html>
